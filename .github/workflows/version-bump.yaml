name: version bump
on:
  workflow_dispatch:
    inputs:
      package:
        description: "Component to update"
        required: true
        type: choice
        options:
          - com.analog.codefusion.vscode
          - com.analog.codefusion.cfsutil
          - com.analog.codefusion.plugins
          - com.analog.codefusion.catalog
          - com.analog.codefusion.zephyr
          - com.analog.codefusion.msdk
          - com.analog.codefusion.arm
          - com.analog.codefusion.riscv
          - com.analog.codefusion.make
          - com.analog.codefusion.cmake
          - com.analog.codefusion.dtc
          - com.analog.codefusion.python-west
          - com.analog.codefusion.openocd
      version:
        description: "Version to bump the component to"
        required: true
        type: string
        default: "1.1.1"
      branch:
        description: "Branch to bump the component on"
        required: true
        type: string
        default: "test"
jobs:
  bump-version:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: get current date
        id: date
        run: echo "DATE=$(date +'%Y-%m-%d')" >> $GITHUB_ENV

      - name: get previous version
        id: prev-version
        run: echo "PREV_VERSION=$(grep -o "<Version>[^<]*</Version>" ./packages/${{inputs.package}}/meta/package.xml | sed 's/<Version>\(.*\)<\/Version>/\1/')" >> $GITHUB_ENV

      - name: check-pre
        run: cat ./packages/${{inputs.package}}/meta/package.xml

      - name: update version
        run: sed -i -E 's|(<Version>).*?(</Version>)|\1'"${{inputs.version}}"'\2|g' ./packages/${{inputs.package}}/meta/package.xml

      - name: update date
        run: sed -i -E 's|(<ReleaseDate>).*?(</ReleaseDate>)|\1'"${{env.DATE}}"'\2|g' ./packages/${{inputs.package}}/meta/package.xml

      - name: check-post
        run: cat ./packages/${{inputs.package}}/meta/package.xml

      - name: prev version
        run: echo ${{env.PREV_VERSION}}

      - name: pullRequestRequired
        run: echo "pullRequestRequired()"

      - name: create-pull-request
        run: echo "create pull request"
        